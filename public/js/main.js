document.addEventListener("DOMContentLoaded",function(){let e=document.querySelectorAll(".slide"),t=document.querySelectorAll(".indicator"),n=document.getElementById("prevBtn"),l=document.getElementById("nextBtn"),o=document.getElementById("heroTitle"),a=document.getElementById("heroSubtitle"),i=0,r;async function s(){let t=await fetch("/api/slideData");slideData=await t.json(),e.forEach((e,t)=>{let n=e.getAttribute("data-bg");e.style.backgroundImage=`url(${n})`}),m()}function c(n){e.forEach(e=>e.classList.remove("active")),t.forEach(e=>e.classList.remove("active")),e[n].classList.add("active"),t[n].classList.add("active"),function e(t){let n=slideData[t];o.style.opacity="0",a.style.opacity="0",o.style.transform="translateY(20px)",a.style.transform="translateY(20px)",setTimeout(()=>{o.textContent=n.title,a.textContent=n.subtitle,o.style.opacity="1",a.style.opacity="1",o.style.transform="translateY(0)",a.style.transform="translateY(0)"},300)}(n),i=n}function d(){let t=(i+1)%e.length;c(t)}function y(){let t=(i-1+e.length)%e.length;c(t)}function m(){r&&clearInterval(r),r=setInterval(d,5e3)}function g(){r&&(clearInterval(r),r=null)}l&&l.addEventListener("click",()=>{g(),d(),m()}),n&&n.addEventListener("click",()=>{g(),y(),m()}),t.forEach((e,t)=>{e.addEventListener("click",()=>{g(),c(t),m()})});let u=document.querySelector(".hero");u&&(u.addEventListener("mouseenter",()=>{r&&g()}),u.addEventListener("mouseleave",()=>{r||m()}));let E=0,p=0,v=!1;if(u){u.addEventListener("pointerdown",e=>{("touch"===e.pointerType||"pen"===e.pointerType)&&(v=!0,E=e.clientX,p=e.clientY,g())}),u.addEventListener("pointermove",e=>{v&&(e.clientX,e.clientY)});let f=e=>{if(!v)return;v=!1;let t=e.clientX-E,n=e.clientY-p;40>Math.abs(n)&&Math.abs(t)>50&&(t<0?d():y()),m()};u.addEventListener("pointerup",f),u.addEventListener("pointercancel",()=>{v=!1,m()})}s();let $=document.getElementById("menuToggle"),I=document.getElementById("navMenu");if($&&I){$.addEventListener("click",function(){I.classList.toggle("active"),$.textContent=I.classList.contains("active")?"✕":"☰"});let B=I.querySelectorAll("a");B.forEach(e=>{e.addEventListener("click",function(){I.classList.remove("active"),$.textContent="☰"})})}let L=document.getElementById("ctaLink");L&&L.addEventListener("click",function(e){e.preventDefault();let t=document.getElementById("portfolio");t&&t.scrollIntoView({behavior:"smooth"})});let h=[],x=1;_();let b=document.getElementById("loadMoreBtn");async function _(){try{let e=await fetch("/api/projects");h=await e.json(),k(x),S()}catch(t){console.error("Errore nel caricamento del portfolio:",t)}}function k(e){let t=document.getElementById("portfolioGrid");if(!t)return;let n=(e-1)*6,l=h.slice(n,n+6);l.forEach(e=>{let n=document.createElement("div");n.className="portfolio-item",n.style.opacity="0",n.style.transform="translateY(30px)",n.innerHTML=`
            <div class="portfolio-image">
                <img src="${e.images[0]}" alt="${e.title}" loading="lazy">
                <div class="portfolio-overlay">
                    <div class="portfolio-info">
                        <h3>${e.title}</h3>
                    </div>
                </div>
            </div>
        `,n.addEventListener("click",function(){(function e(t){let n=h.find(e=>e.id===t);if(!n)return;C=n,j=0,document.getElementById("projectTitle").textContent=n.title,document.getElementById("projectDescription").textContent=n.fullDescription||n.description,document.getElementById("projectLocation").textContent=n.location||"—",document.getElementById("projectYear").textContent=n.data||"—",document.getElementById("projectType").textContent=n.type||"—",document.getElementById("projectCollab").textContent=n.collaboration||"—",document.getElementById("projectStatus").textContent=n.status||"—",M();let l=document.getElementById("projectModal");l.classList.add("active"),document.body.style.overflow="hidden"})(e.id)}),t.appendChild(n),setTimeout(()=>{n.style.transition="opacity 0.6s ease, transform 0.6s ease",n.style.opacity="1",n.style.transform="translateY(0)"},50)})}b&&b.addEventListener("click",function(){k(++x),S()});let C=null,j=0;function M(){if(!C||!C.images)return;let e=document.getElementById("mainImage"),t=document.getElementById("currentImageIndex"),n=document.getElementById("totalImages"),l=document.getElementById("galleryPrev"),o=document.getElementById("galleryNext");e.style.opacity="0",setTimeout(()=>{e.src=C.images[j],e.alt=`${C.title} - Image ${j+1}`,e.style.opacity="1"},200),t.textContent=j+1,n.textContent=C.images.length,l.disabled=0===j,o.disabled=j===C.images.length-1}function Y(){let e=document.getElementById("projectModal");e.classList.remove("active"),document.body.style.overflow="",C=null,j=0}function w(e){C&&C.images&&("next"===e&&j<C.images.length-1?j++:"prev"===e&&j>0&&j--,M())}function S(){let e=document.getElementById("loadMoreContainer");document.getElementById("loadMoreBtn");let t=document.getElementById("projectsCount");if(!e)return;let n=h.length,l=6*x;l<n?(e.style.display="block",t.textContent=`${l} di ${n}`):e.style.display="none"}window.addEventListener("scroll",function(){let e=document.querySelector("header");e&&(window.scrollY>50?e.style.background="rgba(44, 44, 44, 0.95)":e.style.background="transparent")});let T=new IntersectionObserver(function(e){e.forEach(e=>{e.isIntersecting&&(e.target.style.opacity="1",e.target.style.transform="translateY(0)")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".about, .projects").forEach(e=>{e.style.opacity="0",e.style.transform="translateY(30px)",e.style.transition="opacity 0.8s ease-out, transform 0.8s ease-out",T.observe(e)});let q=document.getElementById("modalClose");q&&q.addEventListener("click",Y);let N=document.getElementById("modalExpand");N&&N.addEventListener("click",function e(){let t=document.getElementById("projectModal");document.fullscreenElement?document.exitFullscreen():t.requestFullscreen().catch(e=>{console.log("Error attempting to enable fullscreen:",e)})});let A=document.getElementById("galleryPrev"),D=document.getElementById("galleryNext");A&&A.addEventListener("click",()=>w("prev")),D&&D.addEventListener("click",()=>w("next")),document.addEventListener("keydown",e=>{"Escape"===e.key?Y():"ArrowLeft"===e.key&&C?w("prev"):"ArrowRight"===e.key&&C&&w("next")});let F=document.getElementById("projectModal");function P(e,{minNonSpace:t=10,maxLength:n=2e3}={}){if("string"!=typeof e)return!1;let l=e.trim();if(0===l.length||l.length>n)return!1;let o=l.replace(/\s/g,"").length;return!(o<t||/<[^>]*>/.test(l)||/(.)\1{9,}/.test(l))}F&&F.addEventListener("click",e=>{e.target===F&&Y()}),document.getElementById("contactForm").addEventListener("submit",async e=>{e.preventDefault();let t=document.getElementById("emailTo").value,n=document.getElementById("fullName").value.trim(),l=document.getElementById("email").value.trim(),o=(document.getElementById("message").value||"").trim(),a=!0,i="";if(!1===P(n,{minNonSpace=2,maxLength=30}={})&&(i="Nome non valido!",a=!1),!1===P(o)&&(i="Messaggio troppo corto!",a=!1),!a){(function e(t,n){let l=document.createElement("div");l.className=`custom-dialog ${n}`,l.innerHTML=`
        <div class="custom-dialog-content">
            <p>${t}</p>
            <button class="dialog-btn">OK</button>
        </div>
    `,document.body.appendChild(l),l.querySelector(".dialog-btn").addEventListener("click",()=>{l.remove()}),l.addEventListener("click",e=>{e.target===l&&l.remove()}),setTimeout(()=>{l.parentElement&&l.remove()},5e3)})(i,"error");return}let r=["",`Nome: ${n}`,`Email: ${l}`,"",],s=r.join("\r\n"),c=`mailto:${encodeURIComponent(t)}?subject=${encodeURIComponent("From:Portfolio-architettogiovannaplomitallo.it")}&body=${encodeURIComponent(s)}`;window.location.href=c,document.getElementById("fullName").value="",document.getElementById("email").value="",document.getElementById("message").value="",document.getElementById("privacy").checked=!1})});